function buildSlider(){function a(a){switch(a){case 5:return'5 <span class="hp_tod">AM</span>';case 7:return'7 <span class="hp_tod">AM</span>';case 9:return'9 <span class="hp_tod">AM</span>';case 11:return'11 <span class="hp_tod">AM</span>';case 13:return'1 <span class="hp_tod">PM</span>';case 15:return'3 <span class="hp_tod">PM</span>';case 17:return'5 <span class="hp_tod">PM</span>';case 19:return'7 <span class="hp_tod">PM</span>';default:return'12 <span class="hp_tod">AM</span>'}}time_slider=document.getElementById("hp_timing_slider"),noUiSlider.create(time_slider,{start:[0,5],connect:!0,snap:!0,behaviour:"tap",range:{min:0,"20%":5,"28%":7,"36%":9,"44%":11,"52%":13,"60%":15,"68%":17,"76%":19,max:24},pips:{mode:"range",density:4}}),$(".noUi-value.noUi-value-horizontal.noUi-value-large").each(function(){var b=$(this).html();b=a(parseInt(b)),$(this).html(b)});var b=0,c=5;time_slider.noUiSlider.on("slide",function(a,d){var e=parseInt(a[1]),f=parseInt(a[0]);if(e>c||c>e)if(5>=e)time_slider.noUiSlider.set([0,5]),c=5,b=0;else if(e>5&&19>=e){var g=e-2;time_slider.noUiSlider.set([g,e]),c=e,b=g}else time_slider.noUiSlider.set([19,24]),c=24,b=19;else if(b>f||f>b)if(5>f)time_slider.noUiSlider.set([0,5]),c=5,b=0;else if(f>=5&&19>f){var h=f+2;time_slider.noUiSlider.set([f,h]),c=h,b=f}else time_slider.noUiSlider.set([19,24]),c=24,b=19}),time_slider.noUiSlider.on("change",function(a,b){rebuild_hp_layers()})}function rebuild_hp_layers(){function a(){for(i=0;i<tileGroups.length;i++)i!=tg&&tileGroups[i].clearLayers()}var b=$(this).attr("name");if("hp_measure"===b){hp_metric=$(this).val();var c=$(this).parent().text();$("#hp_metric").html(c),$(".hp_legend_wrapper").toggleClass("hidden")}else{var d=time_slider.noUiSlider.get();hp_time=parseInt(d[0]).toFixed(0)}var e=hp_metric+hp_timing[hp_time];tg=2===tg?0:tg+1;var f=L.esri.tiledMapLayer({url:"http://arcgis.dvrpc.org/arcgis/rest/services/Freight/"+e+"/MapServer",maxZoom:14});tileGroups[tg].clearLayers().addLayer(f),f.on("load",function(){setTimeout(a,500)})}$.getScript("lib/tools/assets/nouislider.js",buildSlider);var hp_map,hp_metric="TTI",hp_time="0",tg=0,tileGroups=[],hp_timing={0:"_0_5",5:"_5_7",7:"_7_9",9:"_9_11",11:"_11_13",13:"_13_15",15:"_15_17",17:"_17_19",19:"_19_24"},time_slider;$(document.body).on("change","#hp_timing_select input",rebuild_hp_layers),$(document.body).on("change","#hp_select input",rebuild_hp_layers);var foo;playing=function(){foo=window.setInterval(function(){var a=time_slider.noUiSlider.get(),b=parseInt(a[1])+2;19>=b?(time_slider.noUiSlider.set([a[1],b]),rebuild_hp_layers()):b>19&&24>b?(time_slider.noUiSlider.set([19,24]),rebuild_hp_layers()):(time_slider.noUiSlider.set([0,5]),rebuild_hp_layers())},2e3)},$(document.body).on("click",".hp_play",function(){$(this).toggleClass("hp_play hp_pause").html('<i class="glyphicon glyphicon-pause"></i>&nbsp;&nbsp;Pause'),playing()}),$(document.body).on("click",".hp_pause",function(){$(this).toggleClass("hp_pause hp_play").html('<i class="glyphicon glyphicon-play"></i>&nbsp;&nbsp;Play'),clearInterval(foo)}),$(document.body).on("mouseup",".hp_filter .btn",function(){$(this).blur()}),$(document.body).on("click","#hp_prev",function(){var a=time_slider.noUiSlider.get(),b=parseInt(a[0])-2;19>=b&&parseInt(a[0])>5?(time_slider.noUiSlider.set([b,a[0]]),rebuild_hp_layers()):0===parseInt(a[0])?(time_slider.noUiSlider.set([19,24]),rebuild_hp_layers()):(time_slider.noUiSlider.set([0,5]),rebuild_hp_layers())}),$(document.body).on("click","#hp_next",function(){clearInterval(foo);var a=time_slider.noUiSlider.get(),b=parseInt(a[1])+2;19>=b?(time_slider.noUiSlider.set([a[1],b]),rebuild_hp_layers()):b>19&&24>b?(time_slider.noUiSlider.set([19,24]),rebuild_hp_layers()):(time_slider.noUiSlider.set([0,5]),rebuild_hp_layers())}),$(function(){function a(){hp_map=L.map("hp-map-wrapper",{minZoom:9,maxZoom:14,zoomControl:!1}).setView([oLat,oLng],10),L.esri.basemapLayer("Gray").addTo(hp_map),hp_map.addControl(new L.Control.mapCenter),hp_map.attributionControl.addAttribution("<b>Performance Measures:</b> DVRPC analysis of NPMRDS truck prode data.");var a=L.esri.tiledMapLayer({url:"http://arcgis.dvrpc.org/arcgis/rest/services/Freight/"+hp_metric+hp_timing[hp_time]+"/MapServer",maxZoom:14});tileGroups=[L.layerGroup().addTo(hp_map),L.layerGroup().addTo(hp_map),L.layerGroup().addTo(hp_map)],tileGroups[tg].clearLayers().addLayer(a)}$.getScript("//cdn.jsdelivr.net/leaflet.esri/1.0.0/esri-leaflet.js",a)});